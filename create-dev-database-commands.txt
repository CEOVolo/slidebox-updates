# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ Hetzner —Å–µ—Ä–≤–µ—Ä–µ
# SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ssh root@135.181.148.104

# 1. –ù–∞–π—Ç–∏ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
POSTGRES_CONTAINER=$(docker ps --filter "name=postgres" --format "{{.ID}}" | head -1)
echo "PostgreSQL container: $POSTGRES_CONTAINER"

# 2. –°–æ–∑–¥–∞—Ç—å dev –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
docker exec -i $POSTGRES_CONTAINER psql -U slidebox_ad -d postgres << 'EOSQL'
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è dev
CREATE USER slidebox_dev_user WITH PASSWORD 'dev_secure_password';

-- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è dev
CREATE DATABASE slidebox_dev OWNER slidebox_dev_user;

-- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤
GRANT ALL PRIVILEGES ON DATABASE slidebox_dev TO slidebox_dev_user;
EOSQL

# 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è —Å—Ö–µ–º—ã public
docker exec -i $POSTGRES_CONTAINER psql -U slidebox_dev_user -d slidebox_dev << 'EOSQL'
-- –ü—Ä–∞–≤–∞ –Ω–∞ —Å—Ö–µ–º—É public
GRANT ALL ON SCHEMA public TO slidebox_dev_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO slidebox_dev_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO slidebox_dev_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO slidebox_dev_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO slidebox_dev_user;
EOSQL

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
docker exec $POSTGRES_CONTAINER psql -U slidebox_ad -d postgres -c "\l"
docker exec $POSTGRES_CONTAINER psql -U slidebox_ad -d postgres -c "\du"

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ dev –±–∞–∑–µ
docker exec $POSTGRES_CONTAINER psql -U slidebox_dev_user -d slidebox_dev -c "SELECT version();"

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç 5432)
netstat -tulpn | grep :5432

# 7. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç –≤ firewall
# ufw allow 5432

echo "‚úÖ Dev –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞!"
echo "üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:"
echo "   –•–æ—Å—Ç: 135.181.148.104:5432"
echo "   –ë–∞–∑–∞: slidebox_dev"
echo "   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: slidebox_dev_user"
echo "   –ü–∞—Ä–æ–ª—å: dev_secure_password" 